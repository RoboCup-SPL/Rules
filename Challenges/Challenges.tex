\documentclass[12pt]{article}

\usepackage{times,fullpage,xspace,fancyhdr,url}
\usepackage[pdftex]{graphicx}
\usepackage[pdftex,
            a4paper,
            colorlinks=true,
            urlcolor=black,
            linkcolor=black,
            citecolor=black,
            bookmarksopen=false,
            bookmarksnumbered=true,
            pdfstartview=FitH]{hyperref}

\usepackage{graphicx}
\usepackage{xspace,color}
\pdfcompresslevel=9
\newcommand{\leaguename}{RoboCup Standard Platform League (NAO) }
\hypersetup{
 pdftitle={\leaguename Technical Challenges 2016 (Draft)},
 pdfauthor={Technical Committee},
}
\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{times}

% comment 'disable' in to disable all the todo notes :)
%\usepackage
%[
%%disable
%]{todonotes}

\sloppy
\newcommand{\ie}{\mbox{i.\,e.}\xspace}
\newcommand{\eg}{\mbox{e.\,g.}\xspace}
\newcommand{\cf}{\mbox{cf.}\xspace}
\newcommand{\comment}[1]{\marginpar{\pdfannot width 4in height .5in depth 8pt {/Subtype /Text /Contents (#1)}}}
\newcommand{\inparagraph}[1]{\paragraph{#1\hspace{-1em} }}

\long\def\commentk#1{{\bf ++K: #1++}}

% some colors
\definecolor{orange}{rgb}{1,0.5,0}
\definecolor{red}{rgb}{1,0,0}
\definecolor{green}{rgb}{0,1,0}


\title{\leaguename \\ Technical Challenges (Draft)}
\author{RoboCup Technical Committee}
\date{(2016 technical challenge rules, as of \today)}

\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 6pt minus 3 pt}
\setcounter{tocdepth}{1}
\widowpenalty=10000
\clubpenalty=10000

\pagestyle{fancy}
\lhead{}
\chead{}
\rhead{}
\lfoot{}
\cfoot{}
\rfoot{}

\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% needed to align an image and text correctly side by side
\newcommand{\imagebox}[1]{\raisebox{2ex}{\raisebox{-\height}{#1}}}



\begin{document}

\maketitle

At RoboCup 2016, the Standard Platform League will hold two different technical challenges, which are described in this document.  Note that this is a preliminary draft of the technical challenges, and hence small details and scoring may be altered.  However, any alterations will be made and announced well before the 2016 competition.

The scores earned in each challenge will vary in magnitude.  Hence, they must be scaled before calculating the overall technical challenge rankings.  Teams who do not participate in a challenge will receive 0 points for that challenge.  The team with the highest total score for a challenge will get 25 points for that challenge, while the team with the lowest total score for a challenge will get 5 points for that challenge.  A linear equation will then be fit to these two points, and each other participating team in that challenge will gain points for that challenge based on this equation.

For both challenges, no changes of code or configuration are allowed for any participating team after the first team starts the challenge. 

Questions or comments on these rules should be mailed to {\small \url{rc-spl-tc@lists.robocup.org}}.

\vfill

\renewcommand\contentsname{Challenges}
\tableofcontents
\setcounter{tocdepth}{1}

\thispagestyle{fancy}

\clearpage

\cfoot{\thepage}
\setcounter{page}{1}

\newcommand{\openMinNum}{three}


% % % % % % % % % % % % % % % % % % % % % % % %


\section{No Wi-Fi Challenge}

The purpose of this challenge is to foster communication without the use of wireless networks.
As in human soccer, communications may be visual, acoustic, or some combination of both.
Infrared communications are also permitted.

\subsection{Setup}
Each participating team has to provide two robots. Insofar as it may affect visual communications,
the robots may wear jerseys if so desired and the
jersey color and pattern may be chosen freely. 

One of the robots shall be designated as
the communication transmitter and the other designated as the communication receiver. 
These robots shall be referred to as T and R respectively.
Both robots will be connected via long ethernet cables to the CommsTester computer.
The robots will not be able to communicate directly with each other by any means except the non-WiFi communications mechanism. In particular, the WLAN interface on the robots must be disabled for the challenge.
A communications tester tool, the CommsTester, running on the CommsTester computer will be used to send messages to T and receive forwarded messages from R. 
All communications between the CommsTester computer and T or R shall be via TCP/IP over ethernet.

Two message types will be used in the challenge: the location message and the data message. The {\em location message} is intended to be representative of some typical information that robots may need to share. The location message  payload consists of a field x,y position defined using integer values in millimeters relative to the SPL standard message coordinate frame.
The {\em data message} is used to evaluate communication of arbitrary binary data. The data message payload consists of an integer fragment offset, used for checking and reassembling a message that has been divided into fragments, an integer data length, and finally the specified number of binary bytes. The maximum data length will be 10,000 bytes. (The detailed message format C code for both message types can be found in the file 
\texttt{SPLNoWifiChallenge.h} provides as part of the \texttt{no\_wifi\_challenge} software the SPL website.)

The robots will be placed by the technical committee. 
R shall be placed in the manually placed goalie
position, that is, in the center of the penalty box with its feet immediately in front of the end line (position 1).
T shall be placed facing R at one of the following positions: the field center spot (position 2) or the far away penalty spot (position 3). It will initially be placed in position 3.

During setup, robots shall be in the penalized state under chest button control. No communication may take place while in this state. Moreover
the robots should disconnect from the CommsTester tool whenever they are penalized.

\subsection{Procedure}
The challenge begins with the location message tests. The game state is changed to playing on both robots using the chest button. 
When the game state changes to playing on T, it should immediately listen for an incoming connection from the CommsTester.
Similarly, when the game state changes to playing on R, it should immediately try to connect to the CommsTester. The default
ports on which T should listen and to which R should connect are specified in the \texttt{SPLNoWifiChallenge.h} file. The network addresses to use
will be specified at the RoboCup event.

The communications tester sends a location message to T which should immediately transmit it to R.
If R receives the location message successfully it should forward it (via ethernet) to the CommsTester. The robot, R, must also point at the corresponding spot on the field for 3 seconds using its right or left arm. Further messages may be sent once R has forwarded the message to the CommsTester or once the message is lost. Except in the cases specified below, three location messages will be sent with T in position 3 and a further three messages will be sent with T in position 2.

There is a timeout period of 15 seconds on location messages. A location message will be considered lost if, after the message being sent by the CommsTester, R does not point or forward the received message to the Game Controller computer within the timeout period. If two messages in a row are lost, the location message part of the challenge will end for this team without further attempts.

Once the CommsTester has sent a message to T, only the first message received by the communications tester from R within the timeout period will be considered for scoring purposes. (This first message will be counted as the attempt even if it is incorrect because it is a repeat of an old message or a much delayed old message.) If either robot clearly sends more than 5 messages in response to a single location message from the communications tester then both robots will be penalized briefly and then unpenalized before the next location message test (at which point they should reset communications). If the problem occurs again, the location message part of the challenge will end for this team without further attempts.

The second part of the challenge is the data communications test. Both robots will be penalized briefly and then unpenalized before starting this second part of the challenge (giving them an opportunity to reset communications).

Not all communication schemes are suitable for general purpose data communications. This part of the challenge investigates the suitability for general purpose data communications by estimating the practical data rate that can be achieved. This test will be performed with T in position 2.
In order to test the possible data rate using the non-WiFi communication scheme, the communications tester will send a single 10,000 byte message to T. T should estimate the number of bytes, N, that it can transmit in 15 seconds using its non-WiFi communications scheme. Thereafter, T must attempt to transmit N or the number of bytes originally received (whichever is less) to R. The data may be fragmented as necessary for the non-WiFi channel. R should forward each fragment received immediately to the communications tester as a separate data message. If communication continues after 15 seconds, subsequent messages will be ignored by the communications tester. The robots will be penalized again at this point if communications have not ended.

The fragment offset in each message received by the communications tester will be used to compare the received message with the corresponding part of the original message sent to T in order to establish the correctness of the data. For example if the communications tester first receives a message with fragment offset 0 and length 10, the bytes of this message will be compared with data bytes 0-9 of the original message. If a later message with fragment offset 30 and length 10 is received, the bytes of this second message will be compared with data bytes 30-39 of the original message. The total number of unique correctly matching bytes received during the allowed time
will be counted. Each data byte received will be compared just once based on the first message which includes that byte. Therefore duplicate messages or messages with overlapping fragments will not artificially increase the number of correctly received bytes.

The error-free data rate will be calculated as follows. The total number of error free bytes is simply the number of unique correctly matched bytes in received fragments. The communication time will be considered to be the full timeout period in the case that the complete data payload originally sent to T has not been received by R during the timeout. In the case that the complete data payload has been received within the timeout period, then the communication time is the difference between the time at which the last data message was received by the CommsTester and the time at which the original large data message was sent to T. Finally the error-free data rate is the total number of error-free bytes received divided by the communications time.

Communication of the data message is considered to have failed if, after the data message being sent by the communications tester, R does not forward any data to the communications tester within 15 seconds.

\subsection{Score}
Scores will be allocated separately for communication of the location messages and communication of the data message.

One point is awarded if R points at the correct spot (as judged visually by the TC) in response to a location message. Further points, based on position, are awarded if the correct location message is forwarded to the communications tester. Two points are awarded for a correctly forwarded message at position 3 and one point for each correct message at position 2. A location message is considered to be correct if the x and y values are within $\pm50$ mm of the originally sent values. No points are awarded for incorrectly received location messages.

Scoring of the data message communication is determined by the error-free data rate. The maximum error-free data rate achieved by any team is awarded 15 points. All other scores are linearly scaled as $dataCommunicationsScore = 15 \times \frac{achievedErrorFreeRate}{maxErrorFreeRate}$. 

\newpage
% % % % % % % % % % % % % % % % % % % % % % % %



\section{Outdoor Challenge}

\subsection{Purpose}
The purpose of this challenge is to foster skills for playing in natural lighting on a more realistic playing surface.

\subsection{Setup}
Each team provides two robots. The ball and one of the robots is manually placed onto the field by the technical committee. The other robot is considered to be the goalie and starts at the manual placement position for goalies on the opposite field side. Hence, the attacking robot will be always positioned in its own half to avoid initial symmetry problems with the localization. Communication is not allowed between the two robots.

The challenge must be conducted outdoors or within a hall consisting of a transparent ceiling. Note that the challenge will be executed twice to increase the chance of playing in lighting conditions that differ from each other.

\subsection{Procedure}
The procedure is as follows: The attacking robot must advance to the ball and make an attempt to score. The goalie should attempt to block the ball. When the ball leaves the field on the side line, it will be replaced according to the SPL rules. When the ball leaves the baseline, the attempt is over. There is a time limit of two minutes. Within this time, each team may have at most three attempts. At the beginning, all robots are in penalized mode. Once the challenge has been started, the robots become unpenalized. After each attempt, both robots are set to the penalized mode again and repositioned by the technical committee.  The ball is also repositioned by the technical committee.

The challenge is executed twice, ideally on different days to increase the chance of having different weather and lighting conditions.

\subsection{Score}
The following events will increase the score for the participating team by one point. All scores are only awarded once per attempt:

\begin{itemize}
\item The attacking robot touches the ball. 
\item The attacking robot moves the ball towards the opponents goal such that it would roll into the goal if unblocked. If the ball passes the goal line outside of the goal, half of a point is awarded and the attempt is over.
\item The goalie attempts to defend the ball, e.g. by executing a well-timed blocking motion. Note that the goalie must move in order to get a point. Hence, standing robots that block the ball will not be awarded a point.
\end{itemize}

For clarity, a successful attempt might look as follows.  The field player touches the ball (1 point), the field player moves the ball towards the goal line in a way that the ball would have been crossed the goal line (1 point), and the goalie blocks the ball (by moving and/or blocking so that we can see that the action was deliberately done) (1 point).

If two teams achieve the same score, the team that was faster in execution of the challenge will be ranked superior.

\end{document}

