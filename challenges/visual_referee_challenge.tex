% !TeX root = ../SPL-Challenges.tex
% !TeX spellcheck = en_US
\section{In-game Visual Referee Challenge}

\subsection{Challenge Goal}

In the current SPL rules, the only time that a robot is required to listen directly to the human referees is for the kick-off and goal whistle. Otherwise, all human referee decisions are communicated to the robots via electronic GameController messages. In moving towards the 2050 RoboCup goal, robots will need to directly interpret referee calls and signals (such as whistles, spoken calls and hand signals), rather than receive information from an external electronic source.
Building on the Visual Referee Challenge from 2022, this year's In-game Visual Referee Challenge asks the robots to detect visual referee signs during a regular match when a whistle has been blown. The normal game play is not influenced by this challenge.

This technical challenge tests a robot's ability to identify three categories of hand signals during a match:
\begin{enumerate}
    \item Static hand signals with one hand.
    \item Static hand signals with two hands.
    \item Dynamic (motion) hand signals with one or two hands.
\end{enumerate}

The intent of this challenge is to choose a \emph{subset} of potential referee calls in SPL matches and test ability of a team to recognize different types of hand signals in preparation for adoption in RoboCup matches.

\subsection{Challenge setup}

As this is an in-game challenge, the challenge is executed during all preliminary matches of the main competition. All usual rules apply and teams are free to participate or not.

During \texttt{set} and anytime during \texttt{playing} when the head referee whistles (Kick-off, goal, half ends), the challenged team (can be both teams) have to look to the T-junction opposite to the GameController operator. At the T-junction of the center field line a challenge assistant will show within \qty{5}{\second} after the whistle a random hand-signal and direction according to the list below for \qty{10}{\second}. The hand-signals and directions are randomly chosen but within the first four whistles there have to be hand-signals from all three classes. The same hand-signal may be chosen twice (with different directions). The challenge assistant is wearing red gloves to distinguish him from the other referees. In case the head referee has to stand on the T-junction, he will stand close to the challenge assistant and do his referee job from that close by position.

The challenge assistant must wear referee clothes and red gloves. The purpose of this clothing is to clearly distinguish the challenge assistant and its hands from the other referees and from the background people. 

The description of this challenge and hand-signals are described based on the viewpoint of the challenge assistant. In these descriptions from the perspective of the head referee the ``red team'' is defined as playing from left-to-right, and the ``blue team'' as playing from right-to-left. The use of colors for identifying teams is used to give equivalence to the head referee calls during the match. Blue and red have to be replaced by the actual colors of that particular match.

The challenged team reports its evaluation of the particular hand-signal and direction using a gamcontroller return message with the decision (Signal, direction, timestamp of whistle) over Wifi. \textbf{Details about this will come.} Only Messages with audio output and message sent within \qty{15}{second} after the signalling started, will be accepted. If multiple messages arrive only the first one from the robot with the lowest number, will be counted.

The challenge assistant has to select before the match starts a suitable number of hand-signal and direction pairs and note them down. An assistant supports the challenge assistant by showing the signal and direction, taking the timing and is also listing to the answer of the robot.

Any whistle within \qty{30}{\second} after another whistle has to be ignored.

\subsection{Available Hand-Signals}

Each hand-signal for the challenge is \textbf{described from the perspective of the head referee} and \textbf{pictured from the perspective of the robots}. Note that for the purpose of clarity, these do not necessarily correspond to human soccer hand-signals.

\begin{figure*}[ht!]
    \centering
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/kick-in.png}
        \caption{\color{blue}Kick-in \textlangle{}blue\textrangle{} Team}
    \end{subfigure}
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/kick-in-flipped.png}
        \caption{\color{red}Kick-in \textlangle{}red\textrangle{} Team}
    \end{subfigure}
    \caption{\textbf{Kick-in \textlangle{}color\textrangle{} Team.} One-handed signal. One arm, extended horizontally in the direction of the half of the field corresponding to the team that receives the Kick-in Free Kick. That is, right arm extended for the ``Blue team'', and left arm extended for the ``Red team''. The non-signal hand is flat and motionless by the side of the body.}
\end{figure*}
    
\begin{figure}[ht!]
    \centering
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/goal-kick.png}
        \caption{\color{blue}Goal Kick \textlangle{}blue\textrangle{} Team}
    \end{subfigure}
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/goal-kick-flipped.png}
        \caption{\color{red}Goal Kick \textlangle{}red\textrangle{} Team}
    \end{subfigure}
    \caption{\textbf{Goal Kick \textlangle{}color\textrangle{} Team.} One-handed signal. One arm, extended 45-degree \emph{up} in the direction of the end of the field where the goal kick will occur. That is, right arm extended for the ``Blue team'', and left arm extended for the ``Red team''. The non-signal hand is flat and motionless by the side of the body.}
\end{figure}

\begin{figure}[ht!]
    \centering
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/corner-kick.png}
        \caption{{\color{blue}Corner Kick \textlangle{}blue\textrangle{} Team}\\ (on the half of the {\color{red} red} team)}
    \end{subfigure}
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/corner-kick-flipped.png}
        \caption{{\color{red}Corner Kick \textlangle{}red\textrangle{} Team} (on the half of the {\color{blue} blue} team)}
    \end{subfigure}
    \caption{\textbf{Corner Kick \textlangle{}color\textrangle{} Team.} One-handed signal. One arm, extended 45-degree \emph{down} in the direction of the team executing the corner kick. That is, right arm extended for the ``Blue team'' executing the corner kick on the ``Red team's'' side, and left arm extended for the ``Red team'' executing the corner kick on the ``Blue team's'' side. The non-signal hand is flat and motionless by the side of the body.}
\end{figure}
    
\begin{figure}[ht!]
    \centering
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/goal.png}
        \caption{\color{blue}Goal \textlangle{}blue\textrangle{} Team}
    \end{subfigure}
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/goal-flipped.png}
        \caption{\color{red}Goal \textlangle{}red\textrangle{} Team}
    \end{subfigure}
    \caption{\textbf{Goal \textlangle{}color\textrangle{} Team.} Two-handed signal. One arm, extended pointing at the center circle. Other arm, extended horizontally in the direction of the half of the field corresponding to the team that scored the goal. That is, right arm extended for the ``Blue team'', and left arm extended for the ``Red team''.}
\end{figure}

\begin{figure}[ht!]
    \centering
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/pushing.png}
        \caption{{\color{blue}Pushing Free-kick \textlangle{}blue\textrangle{} Team}\\ because a {\color{red}red} robot has pushed.}
    \end{subfigure}
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/pushing-flipped.png}
        \caption{{\color{red}Pushing Free-kick \textlangle{}red\textrangle{} Team}\\ because a {\color{blue}blue} robot has pushed.}
    \end{subfigure}
    \caption{\textbf{Pushing Free-kick \textlangle{}color\textrangle{} Team.} Two-handed signal. One arm, vertical with bent elbow and palm facing in the direction of the extended arm. Other arm, extended horizontally in the direction of the half of the field corresponding to the team that is \emph{executing} the Free-kick. That is, left arm extended for the ``Red team'', and right arm extended for the ``Blue team''.}
\end{figure}

\begin{figure}[ht!]
    \centering
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/full-time-start.png}
        % \caption{Inner start point of the dynamic movement}
    \end{subfigure}
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/full-time-end.png}
        % \caption{Outer start point of the dynamic movement}
    \end{subfigure}
    \caption{\textbf{Full-Time.} Dynamic two-handed signal. Both arms slowly move symmetrically inward and outwards on a horizontal plane, bending at the elbows.}
\end{figure}

\begin{figure}[ht!]
    \centering
    \begin{subfigure}{.33\textwidth}
        \centering
        \includegraphics[height=105px]{figs/technical_challenges/player_exchange.png}
        \vspace*{0.5em}
        \caption{Rotation around virtual axis to indicate player exchange}
    \end{subfigure}
    \hspace*{0.5em}
    \begin{subfigure}{.6\textwidth}
        \centering
        \includegraphics[height=120px]{figs/technical_challenges/kick-in.png}
        \includegraphics[height=120px]{figs/technical_challenges/kick-in-flipped.png}
        \caption{Kick-in signal to indicate the team, which is exchanging player. Two possible directions.}
    \end{subfigure}
    \caption{\textbf{Player exchange.} Dynamic two-handed signal. Both arms slowly rotate symmetrically around a virtual horizontal axis parallel to the touchline. After three rotations the referee indicates with the kick-in signal the team, which is exchanging player.}
\end{figure}

\clearpage
\newpage

\subsection{Challenge evaluation}

A team scores 1 point for every hand-signal and 1 point for every direction (team blue, team red or none) correctly identified.
The time for the robot to identify a hand-signal is timed (If a robot fails to identify a hand-signal the time for the hand-signal is \qty{15}{\second}. If a robot incorrectly identifies a hand-signal, the time is how long the robot took to provide the incorrect identification).

As the head referee only whistles in three different match situations (kick-off, goal, end of half), the signals are categorized accordingly. The average points and time per category will be calculated. The average points $\bar{P}_{\mathrm{XXX}}$ are summed with weighting factors as well as the average time $\bar{T}_{\mathrm{XXX}}$:

\begin{equation*}
    \Sigma_\mathrm{Points} = \bar{\mathrm{P}}_{\mathrm{kick\_off}} + 3 \times \bar{\mathrm{P}}_{\mathrm{goal}} + 2 \times \bar{\mathrm{P}}_{\mathrm{end\_of\_half}}
\end{equation*}
\begin{equation*}
    \Sigma_\mathrm{Time} = 3 \times \bar{\mathrm{T}}_{\mathrm{kick\_off}} + \bar{\mathrm{P}}_{\mathrm{goal}} + 2 \times \bar{\mathrm{P}}_{\mathrm{end\_of\_half}}
\end{equation*}

These two vales will be determined for each match. After the preliminary matches have been finished, the minimum number of matches each team has played will be evaluated overall teams with $N$. For each team the total number of points and the total time is calculated as the sum of the $N - 1$ best ranked matches according to the number of points.

Teams are ranked by their total number of points. In the case of a tie, the team with the fastest total time to identify the hand-signals is ranked higher. The team with the highest total number of points, and lowest total time (for tie-breakers), wins this in-game challenge.
